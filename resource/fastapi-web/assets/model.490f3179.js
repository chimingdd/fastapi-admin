import{u as Le,B as Ne,p as Te,y as Ue,i as Ke,z as Me,_ as Pe}from"./index.7bd47cfd.js";/* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                */import{c as P,S as Oe}from"./sortable.esm.f8f875e8.js";/* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css              *//* empty css              */import{d as Re,r as ae,e as c,c as O,w as le,B as r,C,aH as a,aG as l,aL as s,aM as i,aJ as I,aI as D,aD as A,u as x,F as v,D as je,g as He,n as Ge,aK as Je,aF as Qe,bA as We,bB as Xe,b2 as Ye,bC as Ze,b1 as et,bD as tt,bE as at,b5 as lt,bF as ot,ab as nt,aU as st,bi as ut,bj as it,bl as dt,bm as ct,b4 as rt,bG as mt,ad as pt,aT as _t,bH as yt,bI as ft,bJ as gt}from"./arco.17b1a46f.js";import{h as vt,u as bt}from"./vue.32c094a4.js";import{u as kt}from"./loading.44762de3.js";import{q as ht}from"./common.ac936b7b.js";import{s as Ct,q as $t,a as wt,b as Ft,c as Vt}from"./key.b43cc3c5.js";import{q as It}from"./model.6f9d201f.js";import{f as Dt}from"./agent.83156fe6.js";import{q as St}from"./corp.5bda1008.js";import"./chart.d5ce7f1f.js";import"./base.87fcf6e2.js";const qt={class:"container"},zt={class:"action-icon"},Bt={class:"action-icon"},Et={id:"tableSetting"},At={style:{"margin-right":"4px",cursor:"move"}},xt={class:"title"},Lt={name:"KeyList"},Nt=Re({...Lt,setup(Tt){const{loading:oe,setLoading:m}=kt(!0),{proxy:$}=He(),S=vt(),ne=ae({type:"checkbox",showCheckedAll:!0,onlyCurrent:!1}),R=c([]);(async()=>{m(!0);try{const{data:e}=await St();R.value=e.items}catch{}finally{m(!1)}})();const j=c([]);(async()=>{try{const{data:e}=await It();j.value=e.items}catch{}})();const H=c([]);(async()=>{try{const{data:e}=await Dt();H.value=e.items;const o=new Array(0);S.query.agent_id&&(o[0]=S.query.agent_id,n.value.model_agents=o)}catch{}})();const se=async e=>{m(!0);try{await Ct(e),$.$message.success("\u5220\u9664\u6210\u529F"),V()}catch{}finally{m(!1)}},G=()=>({type:2,corp:"",key:"",models:[],model_agents:c(),quota:c(),status:c(),created_at:[]}),{t:u}=Le(),J=c([]),n=c(G()),b=c([]),q=c([]),L=c("medium"),k=c([]),h=c(!0),Q=c(),w={current:1,pageSize:10,showTotal:!0,showPageSize:!0,pageSizeOptions:[10,50,100,500,1e3]},z=ae({...w}),ue=O(()=>[{name:u("searchTable.size.mini"),value:"mini"},{name:u("searchTable.size.small"),value:"small"},{name:u("searchTable.size.medium"),value:"medium"},{name:u("searchTable.size.large"),value:"large"}]),ie=O(()=>[{title:u("key.columns.corp"),dataIndex:"corp_name",slotName:"corp_name",align:"center",width:110},{title:u("key.columns.key"),dataIndex:"key",slotName:"key",align:"center",width:210},{title:u("key.columns.models"),dataIndex:"model_names",slotName:"model_names",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.model_agents"),dataIndex:"model_agent_names",slotName:"model_agent_names",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.used_quota"),dataIndex:"used_quota",slotName:"used_quota",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.remark"),dataIndex:"remark",slotName:"remark",align:"center",ellipsis:!0,tooltip:!0},{title:u("key.columns.status"),dataIndex:"status",slotName:"status",align:"center",width:65},{title:u("key.columns.updated_at"),dataIndex:"updated_at",slotName:"updated_at",align:"center",width:132},{title:u("key.columns.operations"),dataIndex:"operations",slotName:"operations",align:"center",width:170}]),de=O(()=>[{label:u("key.dict.status.1"),value:1},{label:u("key.dict.status.2"),value:2}]),W=new Array(0);S.query.agent_id&&(W[0]=S.query.agent_id);const B=async(e={...w,type:2,model_agents:W})=>{m(!0);try{const{data:o}=await $t(e);J.value=o.items,z.current=e.current,z.pageSize=e.pageSize,z.total=o.paging.total}catch{}finally{m(!1)}},V=()=>{B({...w,...n.value})},ce=e=>{B({...w,...n.value,current:e})},re=e=>{w.pageSize=e,B({...w,...n.value})};B();const me=()=>{n.value=G()},pe=async e=>{m(!0);try{await wt(e),$.$message.success("\u64CD\u4F5C\u6210\u529F"),V()}catch{}finally{m(!1)}},_e=(e,o)=>{L.value=e},ye=(e,o,p)=>{e?b.value.splice(p,0,o):b.value=q.value.filter(_=>_.dataIndex!==o.dataIndex)},X=(e,o,p,_=!1)=>{const f=_?P(e):e;return o>-1&&p>-1&&f.splice(o,1,f.splice(p,1,f[o]).pop()),f},fe=e=>{e&&Ge(()=>{const o=document.getElementById("tableSetting");new Oe(o,{onEnd(p){const{oldIndex:_,newIndex:f}=p;X(b.value,_,f),X(q.value,_,f)}})})};le(()=>ie.value,e=>{b.value=P(e),b.value.forEach((o,p)=>{o.checked=!0}),q.value=P(b.value)},{deep:!0,immediate:!0});const ge=e=>{k.value=e,h.value=!e.length},N=e=>{if(k.value.length===0)$.$message.info("\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E");else{let o=`\u662F\u5426\u786E\u5B9A\u64CD\u4F5C\u6240\u9009\u7684${k.value.length}\u6761\u6570\u636E?`;switch(e.action){case"status":e.value===1?o=`\u662F\u5426\u786E\u5B9A\u542F\u7528\u6240\u9009\u7684${k.value.length}\u6761\u6570\u636E?`:o=`\u662F\u5426\u786E\u5B9A\u7981\u7528\u6240\u9009\u7684${k.value.length}\u6761\u6570\u636E?`;break;case"delete":o=`\u662F\u5426\u786E\u5B9A\u5220\u9664\u6240\u9009\u7684${k.value.length}\u6761\u6570\u636E?`;break}$.$modal.warning({title:"\u8B66\u544A",titleAlign:"start",content:o,hideCancel:!1,onOk:()=>{m(!0),e.ids=k.value,Ft(e).then(p=>{m(!1),$.$message.success("\u64CD\u4F5C\u6210\u529F"),V(),Q.value.selectAll(!1)})}})}},{copy:ve,copied:Y}=bt(),be=async e=>{const{data:o}=await Vt({id:e});ve(o.key)};return le(Y,()=>{Y.value&&$.$message.success("\u590D\u5236\u6210\u529F")}),(e,o)=>{const p=Ne,_=Je,f=Qe,T=We,E=Xe,F=Ye,y=Ze,ke=et,he=tt,U=at,Ce=lt,Z=ot,$e=nt,g=st,ee=Te,te=ut,K=it,we=Ue,Fe=dt,Ve=ct,Ie=Ke,De=Me,Se=rt,qe=mt,ze=pt,Be=_t,Ee=yt,Ae=ft,xe=gt;return r(),C("div",qt,[a(f,{class:"container-breadcrumb"},{default:l(()=>[a(_,null,{default:l(()=>[a(p)]),_:1}),a(_,null,{default:l(()=>[s(i(e.$t("menu.key")),1)]),_:1}),a(_,null,{default:l(()=>[s(i(e.$t("menu.key.model.list")),1)]),_:1})]),_:1}),a(xe,{class:"general-card",bordered:!1,"header-style":{padding:"20px"},"body-style":{padding:"25px 20px 20px 20px"}},{default:l(()=>[a(U,null,{default:l(()=>[a(y,{flex:1},{default:l(()=>[a(Ce,{model:n.value,"label-col-props":{span:5},"wrapper-col-props":{span:18},"label-align":"left"},{default:l(()=>[a(U,{gutter:16},{default:l(()=>[a(y,{span:8},{default:l(()=>[a(F,{field:"corp",label:e.$t("key.form.corp")},{default:l(()=>[a(E,{modelValue:n.value.corp,"onUpdate:modelValue":o[0]||(o[0]=t=>n.value.corp=t),placeholder:e.$t("key.form.selectDefault"),"allow-search":"","allow-clear":""},{default:l(()=>[(r(!0),C(I,null,D(R.value,t=>(r(),A(T,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(y,{span:8},{default:l(()=>[a(F,{field:"key",label:e.$t("key.form.key")},{default:l(()=>[a(ke,{modelValue:n.value.key,"onUpdate:modelValue":o[1]||(o[1]=t=>n.value.key=t),placeholder:e.$t("key.form.key.placeholder"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(y,{span:8},{default:l(()=>[a(F,{field:"models",label:e.$t("key.form.models")},{default:l(()=>[a(E,{modelValue:n.value.models,"onUpdate:modelValue":o[2]||(o[2]=t=>n.value.models=t),placeholder:e.$t("key.form.selectDefault"),"max-tag-count":2,multiple:"","allow-search":"","allow-clear":""},{default:l(()=>[(r(!0),C(I,null,D(j.value,t=>(r(),A(T,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(y,{span:8},{default:l(()=>[a(F,{field:"model_agents",label:e.$t("key.form.modelAgents")},{default:l(()=>[a(E,{modelValue:n.value.model_agents,"onUpdate:modelValue":o[3]||(o[3]=t=>n.value.model_agents=t),placeholder:e.$t("key.form.selectDefault"),"max-tag-count":2,multiple:"","allow-search":"","allow-clear":""},{default:l(()=>[(r(!0),C(I,null,D(H.value,t=>(r(),A(T,{key:t.id,value:t.id,label:t.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a(y,{span:8},{default:l(()=>[a(F,{field:"status",label:e.$t("key.form.status")},{default:l(()=>[a(E,{modelValue:n.value.status,"onUpdate:modelValue":o[4]||(o[4]=t=>n.value.status=t),options:x(de),placeholder:e.$t("key.form.selectDefault"),"allow-clear":""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"])]),_:1}),a(y,{span:8},{default:l(()=>[a(F,{field:"created_at",label:e.$t("key.form.created_at")},{default:l(()=>[a(he,{modelValue:n.value.created_at,"onUpdate:modelValue":o[5]||(o[5]=t=>n.value.created_at=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(Z,{style:{height:"84px"},direction:"vertical"}),a(y,{flex:"86px",style:{"text-align":"right"}},{default:l(()=>[a(te,{direction:"vertical",size:18},{default:l(()=>[a(g,{type:"primary",onClick:V},{icon:l(()=>[a($e)]),default:l(()=>[s(" "+i(e.$t("key.form.search")),1)]),_:1}),a(g,{onClick:me},{icon:l(()=>[a(ee)]),default:l(()=>[s(" "+i(e.$t("key.form.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(Z,{style:{"margin-top":"0","margin-bottom":"16px"}}),a(U,{style:{"margin-bottom":"16px"}},{default:l(()=>[a(y,{span:12},{default:l(()=>[a(te,null,{default:l(()=>[a(g,{type:"primary",onClick:o[6]||(o[6]=t=>e.$router.push({name:"KeyCreate"}))},{default:l(()=>[s(i(e.$t("key.operation.create")),1)]),_:1}),a(g,{type:"primary",status:"success",disabled:h.value,title:h.value?"\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E":"",onClick:o[7]||(o[7]=t=>N({action:"status",value:1}))},{default:l(()=>[s(" \u542F\u7528 ")]),_:1},8,["disabled","title"]),a(g,{type:"primary",status:"danger",disabled:h.value,title:h.value?"\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E":"",onClick:o[8]||(o[8]=t=>N({action:"status",value:2}))},{default:l(()=>[s(" \u7981\u7528 ")]),_:1},8,["disabled","title"]),a(g,{type:"primary",status:"danger",disabled:h.value,title:h.value?"\u8BF7\u9009\u62E9\u8981\u64CD\u4F5C\u7684\u6570\u636E":"",onClick:o[9]||(o[9]=t=>N({action:"delete"}))},{default:l(()=>[s(" \u5220\u9664 ")]),_:1},8,["disabled","title"])]),_:1})]),_:1}),a(y,{span:12,style:{display:"flex",height:"32px","align-items":"center","justify-content":"end"}},{default:l(()=>[a(K,{content:e.$t("searchTable.actions.refresh")},{default:l(()=>[v("div",{class:"action-icon",onClick:V},[a(ee,{size:"18"})])]),_:1},8,["content"]),a(Ve,{onSelect:_e},{content:l(()=>[(r(!0),C(I,null,D(x(ue),t=>(r(),A(Fe,{key:t.value,value:t.value,class:je({active:t.value===L.value})},{default:l(()=>[v("span",null,i(t.name),1)]),_:2},1032,["value","class"]))),128))]),default:l(()=>[a(K,{content:e.$t("searchTable.actions.density")},{default:l(()=>[v("div",zt,[a(we,{size:"18"})])]),_:1},8,["content"])]),_:1}),a(K,{content:e.$t("searchTable.actions.columnSetting")},{default:l(()=>[a(qe,{trigger:"click",position:"bl",onPopupVisibleChange:fe},{content:l(()=>[v("div",Et,[(r(!0),C(I,null,D(q.value,(t,d)=>(r(),C("div",{key:t.dataIndex,class:"setting"},[v("div",At,[a(De)]),v("div",null,[a(Se,{modelValue:t.checked,"onUpdate:modelValue":M=>t.checked=M,onChange:M=>ye(M,t,d)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),v("div",xt,i(t.title==="#"?"\u5E8F\u5217\u53F7":t.title),1)]))),128))])]),default:l(()=>[v("div",Bt,[a(Ie,{size:"18"})])]),_:1})]),_:1},8,["content"])]),_:1})]),_:1}),a(Ae,{ref_key:"tableRef",ref:Q,"row-key":"id",loading:x(oe),pagination:z,columns:b.value,data:J.value,bordered:!1,size:L.value,"row-selection":ne,onPageChange:ce,onPageSizeChange:re,onSelectionChange:ge},{key:l(({record:t})=>[s(i(t.key.length>11?t.key.substr(0,10)+t.key.substr(-10):t.key)+" ",1),a(ze,{class:"copy-btn",onClick:d=>be(t.id)},null,8,["onClick"])]),model_names:l(({record:t})=>{var d;return[s(i(((d=t==null?void 0:t.model_names)==null?void 0:d.join(","))||"-"),1)]}),model_agent_names:l(({record:t})=>{var d;return[s(i(((d=t==null?void 0:t.model_agent_names)==null?void 0:d.join(","))||"-"),1)]}),used_quota:l(({record:t})=>[s(" $"+i(t.used_quota>0?x(ht)(t.used_quota):"0.00"),1)]),remark:l(({record:t})=>[s(i(t.remark||"-"),1)]),status:l(({record:t})=>[a(Be,{modelValue:t.status,"onUpdate:modelValue":d=>t.status=d,"checked-value":1,"unchecked-value":2,onChange:d=>pe({id:`${t.id}`,status:Number(`${t.status}`)})},null,8,["modelValue","onUpdate:modelValue","onChange"])]),operations:l(({record:t})=>[a(g,{type:"text",size:"small",onClick:d=>e.$router.push({name:"KeyDetail",query:{id:`${t.id}`}})},{default:l(()=>[s(i(e.$t("key.columns.operations.view")),1)]),_:2},1032,["onClick"]),a(g,{type:"text",size:"small",onClick:d=>e.$router.push({name:"KeyUpdate",query:{id:`${t.id}`}})},{default:l(()=>[s(i(e.$t("key.columns.operations.update")),1)]),_:2},1032,["onClick"]),a(Ee,{content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417?",onOk:d=>se({id:`${t.id}`})},{default:l(()=>[a(g,{type:"text",size:"small"},{default:l(()=>[s(i(e.$t("key.columns.operations.delete")),1)]),_:1})]),_:2},1032,["onOk"])]),_:1},8,["loading","pagination","columns","data","size","row-selection"])]),_:1})])}}});const ga=Pe(Nt,[["__scopeId","data-v-9b726a2c"]]);export{ga as default};
