import{b as R,a as L,J as ne,_ as B,u as T,k as le}from"./index.71d4ce18.js";/* empty css               *//* empty css               */import{d as E,e as C,B as I,aD as q,aG as t,aH as e,C as D,aE as ue,u as $,aL as w,aM as _,bk as ie,c3 as ce,bN as de,bi as O,bI as me,r as A,c as F,t as pe,b1 as W,b2 as x,aU as G,b5 as M,g as J,F as k,aJ as H,b$ as j,b7 as Q,c4 as X,b3 as Y,a_ as Z,c5 as _e,c6 as fe,aK as ge,aF as be,bC as ve,bD as we,ba as he,b6 as ye}from"./arco.54c7388d.js";/* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css              *//* empty css                */import{g as Ce}from"./common.b0d902a6.js";import"./chart.f14251fc.js";import"./vue.aa90ed69.js";function Pe(g){return R.post("/api/v1/user/update/info",g)}function Se(g){return R.post("/api/v1/user/change/password",g)}function $e(g){return R.post("/api/v1/user/change/email",g)}function Ie(g,u){return R.post("/api/v1/user/change/avatar",g,u)}const Ve=["src"],ke=E({__name:"user-panel",setup(g){const u=L(),r={uid:"-2",name:"avatar.png",url:u.avatar||"/avatar.png"},m=[{label:"userCenter.label.userId",value:u.user_id},{label:"userCenter.label.account",value:u.account},{label:"userCenter.label.name",value:u.name},{label:"userCenter.label.email",value:u.email},{label:"userCenter.label.createdAt",value:u.created_at}],o=C([r]),i=(l,d)=>{o.value=[d]},n=l=>{const d=new AbortController;return async function(){const{onProgress:f,onError:a,onSuccess:s,fileItem:P,name:y="file"}=l;f(20);const b=new FormData;b.append(y,P.file);const S=p=>{let V;p.total>0&&(V=p.loaded/p.total*100),f(parseInt(String(V),10),p)};try{const p=await Ie(b,{controller:d,onUploadProgress:S});s(p)}catch(p){a(p)}}(),{abort(){d.abort()}}};return(l,d)=>{const h=ne,f=ie,a=ce,s=de,P=O,y=me;return I(),q(y,{bordered:!1},{default:t(()=>[e(P,{size:54},{default:t(()=>[e(a,{"custom-request":n,"list-type":"picture-card","file-list":o.value,"show-upload-button":!0,"show-file-list":!1,onChange:i},{"upload-button":t(()=>[e(f,{size:100,class:"info-avatar"},{"trigger-icon":t(()=>[e(h)]),default:t(()=>[o.value.length?(I(),D("img",{key:0,src:o.value[0].url},null,8,Ve)):ue("",!0)]),_:1})]),_:1},8,["file-list"]),e(s,{data:$(m),column:2,align:"right",layout:"inline-horizontal","label-style":{width:"140px",fontWeight:"normal",color:"rgb(var(--gray-8))"},"value-style":{width:"200px",paddingLeft:"8px",textAlign:"left"}},{label:t(({label:b})=>[w(_(l.$t(b))+" :",1)]),value:t(({value:b})=>[w(_(b),1)]),_:1},8,["data","label-style"])]),_:1})]),_:1})}}});const Ee=B(ke,[["__scopeId","data-v-373c68a3"]]),Ue=E({__name:"basic-information",setup(g){const{proxy:u}=J(),{t:r}=T(),m=C(),o=L(),i=C(!1),n=A({form:{name:o.name},rules:F(()=>({name:[{required:!0,message:r("userCenter.basicInfo.form.error.required.name")}]}))}),{form:l,rules:d}=pe(n),h=()=>{i.value||m.value.validate(a=>{a||(i.value=!0,Pe({name:l.value.name}).then(()=>{o.info(),u.$message.success(r("userCenter.basicInfo.form.save.success"))}).finally(()=>{i.value=!1}))})},f=()=>{m.value.resetFields()};return(a,s)=>{const P=W,y=x,b=G,S=O,p=M;return I(),q(p,{ref_key:"formRef",ref:m,model:$(l),rules:$(d),"label-col-props":{span:8},"wrapper-col-props":{span:16},size:"large",class:"form"},{default:t(()=>[e(y,{label:a.$t("userCenter.basicInfo.form.label.name"),field:"name"},{default:t(()=>[e(P,{modelValue:$(l).name,"onUpdate:modelValue":s[0]||(s[0]=V=>$(l).name=V),placeholder:a.$t("userCenter.basicInfo.form.placeholder.name"),"max-length":30},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(y,null,{default:t(()=>[e(S,null,{default:t(()=>[e(b,{loading:i.value,type:"primary",onClick:h},{default:t(()=>[w(_(a.$t("userCenter.basicInfo.form.save")),1)]),_:1},8,["loading"]),e(b,{onClick:f},{default:t(()=>[w(_(a.$t("userCenter.basicInfo.form.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}});const qe=B(Ue,[["__scopeId","data-v-d5a4edb8"]]);const Be={class:"tip"},Fe={class:"content"},Re={class:"operation"},Le=E({__name:"update-pwd",setup(g){const{proxy:u}=J(),{t:r}=T(),m=L(),o=C(),i=C(!1),n=A({oldPassword:"",newPassword:"",rePassword:""}),l=F(()=>({oldPassword:[{required:!0,message:r("userCenter.securitySettings.updatePwd.form.error.required.oldPassword")}],newPassword:[{required:!0,message:r("userCenter.securitySettings.updatePwd.form.error.required.newPassword")},{match:/^(?=.*\d)(?=.*[a-z]).{6,32}$/,message:r("userCenter.securitySettings.updatePwd.form.error.match.newPassword")},{validator:(a,s)=>{a===n.oldPassword?s(r("userCenter.securitySettings.updatePwd.form.error.validator.newPassword")):s()}}],rePassword:[{required:!0,message:r("userCenter.securitySettings.updatePwd.form.error.required.rePassword")},{validator:(a,s)=>{a!==n.newPassword?s(r("userCenter.securitySettings.updatePwd.form.error.validator.rePassword")):s()}}]})),d=()=>{i.value=!1,o.value.resetFields()},h=()=>{o.value.validate(a=>{a||Se({old_password:n.oldPassword,new_password:n.newPassword}).then(()=>{m.info(),d(),u.$message.success(r("userCenter.basicInfo.form.change.success"))})})},f=()=>{i.value=!0};return(a,s)=>{const P=j,y=Q,b=X,S=Y,p=x,V=M,c=Z;return I(),D(H,null,[e(b,null,{avatar:t(()=>[e(P,null,{default:t(()=>[w(_(a.$t("userCenter.securitySettings.password.label")),1)]),_:1})]),description:t(()=>[k("div",Be,_(a.$t("userCenter.securitySettings.password.tip")),1),k("div",Fe,[e(P,null,{default:t(()=>[w(_(a.$t("userCenter.securitySettings.content.hasBeenSet")),1)]),_:1})]),k("div",Re,[e(y,{title:a.$t("userCenter.securitySettings.button.update"),onClick:f},{default:t(()=>[w(_(a.$t("userCenter.securitySettings.button.update")),1)]),_:1},8,["title"])])]),_:1}),e(c,{title:a.$t("userCenter.securitySettings.updatePwd.modal.title"),visible:i.value,"mask-closable":!1,"esc-to-close":!1,onOk:h,onCancel:d},{default:t(()=>[e(V,{ref_key:"formRef",ref:o,model:n,rules:$(l),size:"large"},{default:t(()=>[e(p,{label:a.$t("userCenter.securitySettings.updatePwd.form.label.oldPassword"),field:"oldPassword"},{default:t(()=>[e(S,{modelValue:n.oldPassword,"onUpdate:modelValue":s[0]||(s[0]=v=>n.oldPassword=v),placeholder:a.$t("userCenter.securitySettings.updatePwd.form.placeholder.oldPassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:a.$t("userCenter.securitySettings.updatePwd.form.label.newPassword"),field:"newPassword"},{default:t(()=>[e(S,{modelValue:n.newPassword,"onUpdate:modelValue":s[1]||(s[1]=v=>n.newPassword=v),placeholder:a.$t("userCenter.securitySettings.updatePwd.form.placeholder.newPassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:a.$t("userCenter.securitySettings.updatePwd.form.label.rePassword"),field:"rePassword"},{default:t(()=>[e(S,{modelValue:n.rePassword,"onUpdate:modelValue":s[2]||(s[2]=v=>n.rePassword=v),placeholder:a.$t("userCenter.securitySettings.updatePwd.form.placeholder.rePassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])],64)}}}),De={class:"tip"},ze={class:"content"},Ne={class:"operation"},Te=E({__name:"update-email",setup(g){const{proxy:u}=J(),{t:r}=T(),m=L(),o=C(),i=C(60),n=C(),l=C(!1),d=C(!1),h=C(!1),f=C("userCenter.securitySettings.captcha.get"),a=F(()=>r(f.value)),s=A({email:"",code:"",password:""}),P=F(()=>({newEmail:[{required:!0,message:r("userCenter.securitySettings.updateEmail.form.error.required.newEmail")},{type:"email",message:r("userCenter.securitySettings.updateEmail.form.error.match.newEmail")}],captcha:[{required:!0,message:r("userCenter.securitySettings.form.error.required.captcha")}],currentPassword:[{required:!0,message:r("userCenter.securitySettings.updateEmail.form.error.required.currentPassword")}]})),y=()=>{window.clearInterval(n.value),i.value=60,f.value="userCenter.securitySettings.captcha.get",d.value=!1},b=()=>{l.value||o.value.validateField("newEmail",c=>{c||(l.value=!0,f.value="userCenter.securitySettings.captcha.ing",Ce({email:s.email,channel:"change_email"}).then(v=>{l.value=!1,d.value=!0,f.value=`${r("userCenter.securitySettings.captcha.get")}(${i.value-=1}s)`,n.value=window.setInterval(()=>{i.value-=1,f.value=`${r("userCenter.securitySettings.captcha.get")}(${i.value}s)`,i.value<=0&&y()},1e3)}).catch(()=>{y(),l.value=!1}))})},S=()=>{h.value=!1,o.value.resetFields(),y()},p=()=>{o.value.validate(c=>{c||$e({email:s.email,code:s.code,password:s.password}).then(()=>{S(),m.info(),u.$message.success(r("userCenter.basicInfo.form.save.success"))})})},V=()=>{h.value=!0};return(c,v)=>{const z=j,ee=Q,te=X,K=W,N=x,ae=G,se=Y,re=M,oe=Z;return I(),D(H,null,[e(te,null,{avatar:t(()=>[e(z,null,{default:t(()=>[w(_(c.$t("userCenter.securitySettings.email.label")),1)]),_:1})]),description:t(()=>[k("div",De,_(c.$t("userCenter.securitySettings.email.tip")),1),k("div",ze,[$(m).email?(I(),q(z,{key:0},{default:t(()=>[w(_($(m).email),1)]),_:1})):(I(),q(z,{key:1,class:"tip"},{default:t(()=>[w(_(c.$t("userCenter.securitySettings.email.content")),1)]),_:1}))]),k("div",Ne,[e(ee,{title:c.$t("userCenter.securitySettings.button.update"),onClick:V},{default:t(()=>[w(_(c.$t("userCenter.securitySettings.button.update")),1)]),_:1},8,["title"])])]),_:1}),e(oe,{title:c.$t("userCenter.securitySettings.updateEmail.modal.title"),visible:h.value,"mask-closable":!1,"esc-to-close":!1,onOk:p,onCancel:S},{default:t(()=>[e(re,{ref_key:"formRef",ref:o,model:s,rules:$(P),size:"large"},{default:t(()=>[e(N,{label:c.$t("userCenter.securitySettings.updateEmail.form.label.email"),field:"email"},{default:t(()=>[e(K,{modelValue:s.email,"onUpdate:modelValue":v[0]||(v[0]=U=>s.email=U),placeholder:c.$t("userCenter.securitySettings.updateEmail.form.placeholder.email"),"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(N,{label:c.$t("userCenter.securitySettings.updateEmail.form.label.captcha"),field:"code"},{default:t(()=>[e(K,{modelValue:s.code,"onUpdate:modelValue":v[1]||(v[1]=U=>s.code=U),placeholder:c.$t("userCenter.securitySettings.form.placeholder.captcha"),"max-length":6,"allow-clear":"",style:{width:"80%"}},null,8,["modelValue","placeholder"]),e(ae,{loading:l.value,type:"primary",disabled:d.value,class:"captcha-btn",onClick:b},{default:t(()=>[w(_($(a)),1)]),_:1},8,["loading","disabled"])]),_:1},8,["label"]),e(N,{label:c.$t("userCenter.securitySettings.updateEmail.form.label.currentPassword"),field:"password"},{default:t(()=>[e(se,{modelValue:s.password,"onUpdate:modelValue":v[2]||(v[2]=U=>s.password=U),placeholder:c.$t("userCenter.securitySettings.updateEmail.form.placeholder.currentPassword"),"max-length":32,"allow-clear":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])],64)}}});const Ae=B(Te,[["__scopeId","data-v-77afb8b2"]]),xe=E({__name:"security-settings",setup(g){return(u,r)=>{const m=_e,o=fe;return I(),q(o,{bordered:!1},{default:t(()=>[e(m,null,{default:t(()=>[e(Le)]),_:1}),e(m,null,{default:t(()=>[e(Ae)]),_:1})]),_:1})}}});const Me=B(xe,[["__scopeId","data-v-c0dda919"]]),Je={class:"container"},Ke={name:"Setting"},Oe=E({...Ke,setup(g){return(u,r)=>{const m=le,o=ge,i=be,n=ve,l=we,d=he,h=ye;return I(),D("div",Je,[e(i,{class:"container-breadcrumb"},{default:t(()=>[e(o,null,{default:t(()=>[e(m)]),_:1}),e(o,null,{default:t(()=>[w(_(u.$t("menu.user.center")),1)]),_:1})]),_:1}),e(l,{style:{"margin-bottom":"16px"}},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(Ee)]),_:1})]),_:1}),e(l,{class:"wrapper"},{default:t(()=>[e(n,{span:24},{default:t(()=>[e(h,{"default-active-key":"1",type:"rounded"},{default:t(()=>[e(d,{key:"1",title:u.$t("userCenter.tab.basicInformation")},{default:t(()=>[e(qe)]),_:1},8,["title"]),e(d,{key:"2",title:u.$t("userCenter.tab.securitySettings")},{default:t(()=>[e(Me)]),_:1},8,["title"])]),_:1})]),_:1})]),_:1})])}}});const gt=B(Oe,[["__scopeId","data-v-dcd276b2"]]);export{gt as default};
